@model dynamic
@{
    ViewBag.Title = "تجربة تسجيل طالب";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="form-header" id="SystemTestHeading">تجربة تسجيل طالب</h2>


<form class="form-inline font-sz-lg print-content" id="FormSearchStudent">
    

    @Html.Label("رقم الطالب", new {@for = "SearchStudentID"})

    <input type="number" id="SearchStudentId" autofocus class="form-control"/>

    <div class="alert alert-success alert-dismissible hidden" id="RegistrationSuccess">
        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        <strong>نجاح!</strong> تم تسجيل الحضور بنجاح.
    </div>

    <div class="alert alert-warning alert-dismissible hidden" id="RegistrationWarning">
        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        <strong>تحذير!</strong> تم تسجيل حضور هذا الشخص بالفعل
    </div>

    <div class="alert alert-danger alert-dismissible hidden" id="RegisteredAlready">
        <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
        <strong>فشل!</strong> هذا الطالب غير مسجل
    </div>

    <div class="sk-folding-cube hidden" id="loader">
        <div class="sk-cube1 sk-cube"></div>
        <div class="sk-cube2 sk-cube"></div>
        <div class="sk-cube4 sk-cube"></div>
        <div class="sk-cube3 sk-cube"></div>
    </div>

    <button type="button" class="btn btn-primary btn-lg" id="SystemTestPrintButton" onclick="printStudents();"> طباعة الطلاب المسجلين</button>
</form>

<div class="container hidden" id="SystemTestPrintableArea">

</div>

@section scripts
{
    <script>
        
        // Registering Students
        $("#SearchStudentId").on("keyup", function () {
            if ($("#SearchStudentId").val().length === 5) {

                $("#loader").removeClass("hidden");
                $("#SearchStudentId").blur();
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("RegisterStudent","SystemTest")',
                    data: { studentId: $("#SearchStudentId").val() },
                    success: function (message) {
                        if (message === "success") {
                            $("#loader").addClass("hidden");
                            $("#RegistrationSuccess").removeClass("hidden");
                            setTimeout(function() {
                                $("#RegistrationSuccess").addClass("hidden");
                                $("#SearchStudentId").val("");
                                $("#SearchStudentId").focus();
                            },1500);
                        } else if (message === "student registered") {
                            $("#loader").addClass("hidden");
                            $("#RegistrationWarning").removeClass("hidden");
                            setTimeout(function() {
                                $("#RegistrationWarning").addClass("hidden");
                                $("#SearchStudentId").val("");
                                $("#SearchStudentId").focus();
                            },1500);
                        } else {
                            $("#loader").addClass("hidden");
                            $("#RegisteredAlready").removeClass("hidden");
                            setTimeout(function () {
                                $("#RegisteredAlready").addClass("hidden");
                                $("#SearchStudentId").val("");
                                $("#SearchStudentId").focus();
                            },1500);
                        }

                    }

                });
            }
            else {
                $("#invitationList").empty();
            }
        });

        // Printing All Registered Students
        function printStudents() {
            var url = '@Url.Action("GetAllStudents", "SystemTest")';

            // loading Partial View with students
            $('#SystemTestPrintableArea').load(url, function() {
                // Printing Students
                window.print();
            });

            
        }

        
    </script>
}